{% extends 'BundlesDefaultBundle:Layouts:main.html.twig' %}
{% block title metaTags.title %}
{% block meta_description metaTags.description %}
{% block meta_keywords metaTags.keywords %}
{% block js %}
    {{ parent() }}
    <script>
        window.searchForm = {{ form|json_encode|raw }};
    </script>
    <script src="{{ asset('build/dist/js/index/index.js') }}" type="text/javascript"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&language=ru&libraries=geometry"></script>
    <script>
        function initializeGoogleMaps() {
            var coord =  new google.maps.LatLng("{{ data.cityFrom.cityLat }}", "{{ data.cityFrom.cityLng }}");
            var mapOptions = {
                center: coord,
                zoom: 2,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(document.getElementById("map"),mapOptions);
            var marker = new google.maps.Marker({
                position: coord,
                map: map,
                visible: false,		title: "{{ data.cityFrom.cityRus }}"
            });
            var coord2 = new google.maps.LatLng("{{ data.cityTo.cityLat }}", "{{ data.cityTo.cityLng }}");
            var marker2 = new google.maps.Marker({
                position: coord2,
                map: map,
                visible: false,
                title: "{{ data.cityTo.cityRus }}"
            });
            var bounds = new google.maps.LatLngBounds();
            bounds.extend(coord);
            bounds.extend(coord2);
            //log(bounds);
            var mapCenter = bounds.getCenter();
            map.setCenter(mapCenter);
            map.fitBounds(bounds);
            var lineSymbol = {
                path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW
            };
            var mapRoute = new google.maps.Polyline({
                path: [coord,coord2],
                strokeColor: "#ff801e",
                geodesic: true,
                strokeOpacity: 1.0,
                strokeWeight: 2,
                icons: [{
                    icon: lineSymbol,
                    offset: '100%'
                }]
            });
            mapRoute.setMap(map);
        }

        google.maps.event.addDomListener(window, 'load', initializeGoogleMaps);
    </script>
{% endblock %}
{% block content %}
    <div ng-controller="IndexCtrl">
        <div class="form-search-line container">
            <h1>{{ h1 }}</h1>
            <div class="list-name-field">
                <div class="departure-from input-group">
                    <label for="#from-avia-1">{{ 'frontend.search_form.city_from'|trans }}:</label>
                    <div class="input">
                        <auto-complete
                                search-length="3"
                                ng-model="searchForm.formValue.departureCode.data"
                                attr-id="from-avia"
                                attr-placeholder="{{ 'frontend.search_form.placeholders.city'|trans }}"
                                reverse-component="1"
                                view-value="{% verbatim %}{{ searchForm.formValue.arrivalCity.data }}{%endverbatim%}"
                                >
                        </auto-complete>
                        <span class="icon">
                            <i class="icon-metka"></i>
                        </span>
                    </div>
                </div>

                <div class="arriving-in input-group">
                    <label for="#down-avia-1">{{ 'frontend.search_form.city_to'|trans }}:</label>
                    <div class="input">
                        <auto-complete
                                search-length="3"
                                ng-model="searchForm.formValue.arrivalCode.data"
                                attr-id="down-avia"
                                attr-placeholder="{{ 'frontend.search_form.placeholders.city'|trans }}"
                                reverse-component="2"
                                view-value="{% verbatim %}{{ searchForm.formValue.arrivalCity.data }}{%endverbatim%}"
                                >

                        </auto-complete>
                        <span class="icon">
                            <i class="icon-metka"></i>
                        </span>
                    </div>
                </div>
                <div class="date-simple up-date input-group">
                    <label for="#up-date">{{ 'frontend.search_form.date_from'|trans }}:</label>
                    <div class="input">
                        <ng-datepicker
                                attr-id="up-date"
                                placeholder="{{ 'frontend.search_form.placeholders.date'|trans }}"
                                ng-model="searchForm.formValue.departureDate.data"
                                name="departureDate"
                                max-from="arrivalDate"
                                >

                        </ng-datepicker>
                        <span class="icon">
                            <i class="icon-date"></i>
                        </span>
                    </div>
                </div>
                <div class="date-simple down-date input-group">
                    <label for="#down-date">{{ 'frontend.search_form.date_to'|trans }}:</label>
                    <div class="input">
                        <ng-datepicker
                                attr-id="down-date"
                                placeholder="{{ 'frontend.search_form.placeholders.date'|trans }}"
                                ng-model="searchForm.formValue.arrivalDate.data"
                                name="arrivalDate"
                                min-from="departureDate"
                                >

                        </ng-datepicker>
                        <span class="icon">
                            <i class="icon-date"></i>
                        </span>
                    </div>
                </div>
                <div class="adults input-group">
                    <label for="#adults">Взрослые</label>
                    <div class="select">
                        <select id="adults" name="adults" ng-model="searchForm.formValue.adults.data" ng-options="item.data as item.label for item in searchForm.formValue.adults.choices">

                        </select>
                    </div>
                </div>
                <div class="children input-group">
                    <label for="#children">Дети</label>
                    <div class="select">
                        <select id="children" name="children" ng-model="searchForm.formValue.children.data"  ng-options="item.data as item.label for item in searchForm.formValue.children.choices">

                        </select>
                    </div>
                    <a href="#" class="age-rule-link">Правила перевозки детей <i class="icon-window"></i></a>
                </div>
                <div class="infant input-group">
                    <label for="#infant">Младенцы</label>
                    <div class="select">
                        <select id="infant" name="infant" ng-model="searchForm.formValue.infant.data" ng-options="item.data as item.label for item in searchForm.formValue.infant.choices">

                        </select>
                    </div>
                </div>
                <div class="button-buy-wrap">
                    <button class="button button-buy" type="submit" ng-click="search()">Искать</button>
                </div>
            </div>
        </div>
        <!-- Быстрый поиск в линию -->
        <!-- Таблица цен -->
        <div class="table-price-content">
            <div class="title">
                <h2>Таблица цен на неделю вперед</h2>
            </div>
            <div class="table-content">
                <div class="table-price">
                    <div class="calendar-block">
                        <div class="calendar-head">
                            <h3>Лучшие цены в пределах +/- 3 дней</h3>
                        </div>
                        <div class="calendar-body">
                            <div class="obratno"><i class="left-arrow"></i> Обратно</div>
                            <table id="calendar_table" class="table-calendar">
                                <tbody>
                                <tr>
                                    <td class="">
                                        <span class="tuda"><i class="right-arrow"></i> Туда</span>
                                    </td>
                                    <td class="">25.06.2015</td>
                                    <td class="">26.06.2015</td>
                                    <td class="">27.06.2015</td>
                                    <td class="">28.06.2015</td>
                                    <td class="">29.06.2015</td>
                                    <td class="">30.06.2015</td>
                                    <td class="">01.07.2015</td>
                                </tr>
                                <tr>
                                    <td class="">24.06.2015</td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                </tr>
                                <tr>
                                    <td class="">25.06.2015</td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                </tr>
                                <tr>
                                    <td class="">26.06.2015</td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                </tr>
                                <tr>
                                    <td class="">27.06.2015</td>
                                    <td class=""><span class="text-warning calendar-item"></span></td>
                                    <td class=""><span class="text-warning calendar-item"></span></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                    <td class=""><a href="#">18 176 RUB</a></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="table-text">
                    {{ content|raw }}
                </div>
            </div>
        </div>
        <!-- Таблица цен -->
        <!-- Карта полета -->
        <div class="map-direction">
            <div class="title">
                <h2>Карта полета</h2>
            </div>
            <div class="map-wrap" id="map" style="height: 800px;">
            </div>
        </div>
        <!-- Карта полета -->
        <div class="empty"></div>
    </div>
    {% include 'BundlesDefaultBundle:AngularViews:angViews.html.twig' %}
{% endblock %}