{% set needBook = needBook is defined ? needBook : true %}
{% for ticket in data %}

    <div class="well">
        <strong class="text-danger">{{ ticket.totalPrice|number_format(0,'.',' ') }} руб</strong>
        <strong  class="text-warning">{{ ticket.firstItinerarie.firstVariant.departureSegment.departureDate|date("d.m.Y") }}</strong>
        {% if needBook %}
            <form action="{{ path("bundles_default_api_info") }}" class="book-form">
        {% endif %}
        {% for int in ticket.itineraries %}
            {% set parent_loop = loop %}
            {% for variant in int.variants %}



                <div class="panel panel-info">
                    <div class="panel-heading">
                        <div class="panel-title"></div>
                    </div>
                    <div class="panel-body">
                        <div class="col-md-1">
                                <input value="{{ variant.variantID }}"
                                       type="radio" {% if loop.first %} checked="checked" {% endif %}
                                       name="info[variants][{{ parent_loop.index-1 }}]"/>
                                <input type="hidden" name="info[request_id]" value="{{ ticket.requestId }}">
                        </div>
                        <div class="col-md-3">
                            <div class="logo-{{ variant.departureSegment.marketingAirline }}"></div>
                            <div>
                                <strong>
                                    {{ variant.departureSegment.marketingAirlineName }}
                                </strong>
                            </div>
                            <small>{{ variant.departureSegment.marketingAirline }} {{ variant.departureSegment.flightNumber }}</small>
                            {#<div>#}
                                {#<small> Колличество мест: {{ variant.departureSegment.availableSeats }}</small>#}
                            {#</div>#}
                        </div>
                        <div class="col-md-3">
                            <div>
                                <div>
                                    <small>Время вылета:</small>

                                </div>
                                <strong class="text-warning">{{ variant.departureSegment.departureDate|date("H:i") }}</strong>
                            </div>
                            <strong>{{ variant.departureSegment.departureCityName }}
                                , {{ variant.departureSegment.departureCountryName }}</strong>

                            <div>
                                <small>{{ variant.departureSegment.departureAirportName }}</small>
                            </div>

                        </div>
                        <div class="col-md-3">
                            <div>
                                <div>
                                    <small>Время прилета:</small>

                                </div>
                                <strong class="text-warning">{{ variant.arrivalSegment.arrivalDate|date("H:i") }}</strong>
                            </div>
                            <strong>{{ variant.arrivalSegment.arrivalCityName }}
                                , {{ variant.arrivalSegment.arrivalCountryName }}</strong>

                            <div>
                                <small>{{ variant.arrivalSegment.arrivalAirportName }}</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <small>Продолжительность:</small>
                            <div>
                                <strong class="text-warning">{{ variant.duration|secondToTime }}</strong>
                            </div>
                            {% if variant.countTransplant %}
                                <div>
                                    <div  class="text-info show-transplant" style="cursor: pointer">
                                        {{ variant.countTransplant }} {{ variant.decl(variant.countTransplant,['пересадка','пересадок','пересадок']) }}
                                    </div>
                                    <div class="popup">
                                        <table>
                                            <tbody>
                                                {% for a in variant.transplantAirports %}
                                                    <tr>
                                                        <td>
                                                            <strong>
                                                                {{ a.name }}
                                                            </strong>
                                                        </td>

                                                    </tr>
                                                    <tr>
                                                        <td><small>Между рейсами:</small></td>
                                                        <td><strong>{{ a.time|secondToTime }}</strong></td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                        <div>
                                            <small class="close-popup text-danger pull-right" style="cursor: pointer">Закрыть</small>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>

                    </div>
                </div>
            {% endfor %}
            <hr/>

        {% endfor %}
        {% if needBook %}
            <div class="" style="margin-bottom: 15px">
                <div class="col-md-offset-9">
                    <input style="margin-left: 42%" class="btn btn-primary" type="submit" value="Забронировать">
                </div>
            </div>
            </form>
        {% endif %}
    </div>
{% endfor %}
<script>
    $(document).ready(function(){
        $('.show-transplant').on('click',function(){
            var popup = $(this).parent('div').find('.popup').popup({
                popup : {
                    position : 'absolute',
                    bottom:0,
                    right:0,
                    display: 'none',
                    'z-index': 10000
                },
                overlay : {
                    background : 'none',
                    'z-index': 1000
                },
                closeOnClickOverlay: true,
                closeSelectors : ['.close-popup']
            });
            var self = $(this);
            popup.openWithOutOffsets();
        });
    });
</script>
<style>
    .popup{
        display: none;
        background-color: #ffffff;
        z-index: 10000;
        box-shadow: 1px 2px 6px -3px #000000;
        padding: 25px;
        border: 1px solid #cccccc;
        width: 350px;
    }
</style>